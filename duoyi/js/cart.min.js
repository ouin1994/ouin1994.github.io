"use strict";$(".header").load("../layout/header.html"),$("#footer").load("../layout/footer.html");var layer=void 0;layui.use("layer",function(){layer=layui.layer});var username=getCookie("userLogin");function addAndReduce(a,t,e,s){var l=1*e;$.ajax({type:"get",url:"http://"+(-1<location.host.indexOf(":5500")?"localhost":location.host)+"/project/cart-add.php",data:{username:username,goods_id:a,goods_count:l},dataType:"json",success:function(a){if(a.data){s(t+l)}else layer.msg(a.msg),$(".add").attr("data-click",1),$(".reduce").attr("data-click",1)}})}function getTotal(){for(var a=0,t=0,e=0;e<$(".select .active").length;e++)t+=1*$($(".select .active")[e]).parent().siblings(".numbers").find(".count").val(),a+=1*$($(".select .active")[e]).parent().siblings(".total").html();$(".goods-num span").html(t),$(".money span").html("ï¿¥"+a.toFixed(2))}function checkAll(){"active"==$(".bar-01 i").attr("class")?($(".bar-01 i").removeClass("active"),$(".select i").removeClass("active"),$(".select i").addClass("other")):($(".bar-01 i").addClass("active"),$(".select i").addClass("active"),$(".select i").removeClass("other")),getTotal(),goPay()}function goPay(){var a=0;$(".select i").each(function(){"active"==this.className&&a++}),0<a?$(".go-pay").prop({disabled:!1}).css({cursor:"pointer",backgroundPosition:"-172px -60px"}):$("#go-pay").prop({disabled:!0}).css({cursor:"default",backgroundPosition:"0 0"})}$.ajax({type:"get",url:"http://"+(-1<location.host.indexOf(":5500")?"localhost":location.host)+"/project/cart-list.php",data:{username:username},dataType:"json",success:function(a){if(a.data[0]){$(".no-goods").css({display:"none"}),$(".has-goods").css({display:"block"});var c="";a.data.forEach(function(a){var t=a.goods_name,e=a.goods_price,s=a.goods_desc,l=a.goods_img,o=a.goods_count,i=a.goods_id;c+='\n                        <ul>\n                            <li class="select">\n                                <i class="other"></i>\n                            </li>\n                            <li class="goods">\n                                <div class="left">\n                                    <img src='+l+'>\n                                </div>\n                                <div class="right">\n                                    <h4 class="goods-name sl">'+t+'</h4>\n                                    <p class="desc">'+s+'</p>\n                                </div>\n                            </li>\n                            <li class="prices">'+e+'</li>\n                            <li class="numbers" data_id="'+i+'">\n                                <span class="reduce" data-click="1"><i></i></span>\n                                <input class=\'count\' type="text" value=\''+o+'\'>\n                                <span class="add" data-click="1"><i></i></span>\n                            </li>\n                            <li class="total">'+(Number(e)*Number(o)).toFixed(2)+'</li>\n                            <li class="handle">\n                                <i class="delete"></i>\n                            </li>\n                        </ul>'}),$(".goods-list").html(c)}else $(".no-goods").css({display:"block"}),$(".has-goods").css({display:"none"})}}),$(document).on("click",".bar-01 i",function(){checkAll(),goPay()}),$(document).on("click",".select i",function(){"active"==$(this).attr("class")?($(this).removeClass("active"),$(this).addClass("other")):($(this).addClass("active"),$(this).removeClass("other")),0==$(".select i").filter(".other").length&&($(".bar-01 i").addClass("active"),$(".bar-01 i").removeClass("other")),$(".select i").filter(".active").length<$(".select i").length&&($(".bar-01 i").addClass("other"),$(".bar-01 i").removeClass("active")),getTotal(),goPay()}),$(document).on("click",".add",function(){var t=this;if(1*$(t).attr("data-click")){$(t).attr("data-click",0);var a=1*$(t).parent().attr("data_id"),e=1*$(t).prev().val(),s=1*$(t).parent().prev().html();addAndReduce(a,e,1,function(a){$(t).attr("data-click",1),$(t).prev().val(a),$(t).parent().next().html((a*s).toFixed(2)),getTotal()})}}),$(document).on("click",".reduce",function(){var t=this;if(1*$(t).attr("data-click")){$(t).attr("data-click",0);var a=1*$(t).parent().attr("data_id"),e=1*$(t).next().val(),s=1*$(t).parent().prev().html();e<=1?($(t).next().html("1"),$(t).attr("data-click",1)):addAndReduce(a,e,-1,function(a){$(t).attr("data-click",1),$(t).next().val(a),$(t).parent().next().html((a*s).toFixed(2)),getTotal()})}}),$(document).on("click",".delete",function(){var t=this,a=$(t).parent().prev().prev().attr("data_id");$.ajax({type:"get",url:"http://"+(-1<location.host.indexOf(":5500")?"localhost":location.host)+"/project/cart-delete.php",data:{username:username,goods_id:a},dataType:"json",success:function(a){a.data?(layer.msg(a.msg),0==$(".select i").filter(".other").length&&($(".bar-01 i").addClass("active"),$(".bar-01 i").removeClass("other")),$(".select i").filter(".active").length<$(".select i").length&&($(".bar-01 i").addClass("other"),$(".bar-01 i").removeClass("active")),$(t).parent().parent().remove(),getTotal()):layer.msg(a.msg)}})}),$(document).on("click",".go-pay",function(){var a=$(".select .active").parent().siblings(".numbers"),t="";a.each(function(){t+=$(this).attr("data_id")+"="}),t=t.substring(0,t.length-1),localStorage.setItem("id",t),location.href="./goods-pay.html"}),goPay();