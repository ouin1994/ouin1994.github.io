"use strict";$(".header").load("../layout/header.html"),$("#footer").load("../layout/footer.html");var layer=void 0;layui.use("layer",function(){layer=layui.layer});var username=getCookie("userLogin");function renderAddress(){$.ajax({type:"get",url:"http://"+(-1<location.host.indexOf(":5500")?"localhost":location.host)+"/project/address-list.php",data:{username:username},dataType:"json",success:function(t){if(t=t.data){var c="";t.forEach(function(t){var e=t.addname,a=t.addplace,i=t.addtel,s=t.defaultnews,n=t.id;c+='\n                    <div class="item">\n                        <div class="item-left">\n                            <i class=""></i>\n                            <span class="add-name">'+e+'</span>\n                            <span class="place">'+a+'</span>\n                            <span class="tel">'+i+'</span>\n                            <span class="default-select active">'+(s="true"==s?"默认":"普通")+'</span>\n                        </div>\n                        <div class="item-right">\n                            <span class="edit" data-id="'+n+'">编辑</span>\n                            <span class="del" data-id="'+n+'">删除</span>\n                        </div>\n                    </div>'}),$(".address-list").html(c)}else $(".address-list").empty()}})}function ajax(t,e,a,i,s,n){$.ajax({type:"get",url:t,data:{username:e,addName:a,phoneNum:i,address:s,defaultNews:n},dataType:"json",success:function(){renderAddress(),layer.msg("设置成功"),$("#sure").attr("data-click",1),$(".div").hide(),$("#username").val(""),$("#phone").val(""),$("#province .show").text("请选择省份"),$("#city .show").text("请选择城市"),$("#area .show").text("请选择区域"),$("#street").val("")}})}function fn(t){var a=formateData(t),i="";a.forEach(function(t){var e=t.city_id,a=t.name;return i+='<li city_id="'+e+'">'+a+"</li>"}),$("#province ul").html(i),$("#province").on("click",function(){console.log(6666),$("#province ul").show(),$("#city .show").text("请选择城市"),$(".select-city").html(""),$("#area .show").text("请选择区域"),$(".select-area").html("")}),$(".select-prov").off("click").on("click","li",function(t){(event||t).stopPropagation(),$(".select-prov").hide(),$("#province .show").text($(this).html());var e=$(this).attr("city_id");renderCity(a.filter(function(t){return t.city_id==e})[0].list),$("#area").on("click",function(){$(".select-area").show()}),$(".select-area").on("click","li",function(t){(event||t).stopPropagation(),$("#area .show").text($(this).html()),$(".select-area").hide()})})}function renderCity(s){var i="";s.forEach(function(t){var e=t.city_id,a=t.name;return i+='<li city_id="'+e+'">'+a+"</li>"}),$(".select-city").html(i),$("#city").on("click",function(){$(".select-city").show(),$("#area .show").text("请选择区域"),$(".select-area").html("")}),$(".select-city").off("click").on("click","li",function(t){(event||t).stopPropagation(),$(".select-city").hide(),$("#city .show").text($(this).html());var e=$(this).attr("city_id"),a=s.filter(function(t){return t.city_id==e})[0].list,i="";a.forEach(function(t){var e=t.city_id,a=t.name;i+='<li city_id="'+e+'">'+a+"</li>"}),$(".select-area").html(i)})}function formateData(t){var e={city_id:"CH98",name:"直辖市",en:"",list:t.filter(function(t){var e=t.city_id;return"CH01"==e||"CH02"==e||"CH03"==e||"CH04"==e})},a={city_id:"CH99",name:"特别行政区",en:"",list:t.filter(function(t){var e=t.city_id;return"CH32"==e||"CH33"==e})},i=t.filter(function(t){var e=t.city_id;return!("CH01"==e||"CH02"==e||"CH03"==e||"CH04"==e||"CH32"==e||"CH33"==e)});return i.unshift(e,a),i}$.ajax({type:"get",url:"http://"+(-1<location.host.indexOf(":5500")?"localhost":location.host)+"/project/cart-list.php",data:{username:username},dataType:"json",success:function(t){var i=localStorage.getItem("id");i=i.split("=");var s=[];if(t.data.forEach(function(t,e){for(var a=0;a<i.length;a++)t.goods_id==i[a]&&s.push(t)}),s[0]){var c="";s.forEach(function(t){var e=t.goods_name,a=t.goods_price,i=t.goods_desc,s=t.goods_img,n=t.goods_count;c+='\n                <ul>\n                    <li class="goods">\n                        <div class="left">\n                            <img src='+s+'>\n                        </div>\n                        <div class="right">\n                            <h4 class="goods-name sl">'+e+'</h4>\n                            <p class="desc">'+i+'</p>\n                        </div>\n                    </li>\n                    <li class="prices">'+a+'</li>\n                    <li class="numbers">'+n+'</li>\n                    <li class="total">'+(Number(a)*Number(n)).toFixed(2)+"</li>\n                </ul>"}),$(".goods-list").html(c);for(var e=0,a=0,n=0;n<$(".numbers").length;n++)e+=1*$($(".numbers")[n]).html(),a+=1*$($(".total")[n]).html();$(".goods-total").html(e),$(".price-total").html(a),$(".must-pay span").html("￥"+a)}}}),$(document).on("click",".agreement i",function(){"active"==$(this).attr("class")?$(this).attr("class",""):$(this).attr("class","active")}),$(document).on("click",".setAddress",function(){$(".div").show();$.ajax({type:"get",url:"http://api.yytianqi.com/citylist/id/2",data:{},dataType:"json",success:function(t){fn(t=t.list)}}),$(document).on("click",".add-title span",function(){$(".div").css({display:"none"}),$("#username").val(""),$("#phone").val(""),$("#province .show").text("请选择省份"),$("#city .show").text("请选择城市"),$("#area .show").text("请选择区域"),$("#street").val("")}),$(document).on("click","#cancel",function(){$(".div").css({display:"none"}),$("#username").val(""),$("#phone").val(""),$("#province .show").text("请选择省份"),$("#city .show").text("请选择城市"),$("#area .show").text("请选择区域"),$("#street").val("")}),$(document).on("click",".default i",function(){"active"==$(this).attr("class")?$(this).removeClass("active"):$(this).addClass("active")}),$(document).on("click","#sure",function(){var t=this;if(1*$(t).attr("data-click")){$(t).attr("data-click",0);var e=$("#username").val();if(""==e)return layer.msg("请填写名称"),void $(t).attr("data-click",1);e=e;var a=$("#phone").val();if(11!=a.length||!/^1[0-9]{10}$/gi.test(a))return layer.msg("请填写正确的电话号码"),void $(t).attr("data-click",1);a=a;var i=$("#province .show").html()+"省"+$("#city .show").html()+"市"+$("#area .show").html()+"区"+$("#street").val();if("请选择区域"==$("#area .show").html()||!$("#street").val())return layer.msg("请填写正确的地址"),void $(t).attr("data-click",1);i=i;var s=0!=("active"==$(".default i").attr("class")?"默认":"").length;ajax("http://"+(-1<location.host.indexOf(":5500")?"localhost":location.host)+"/project/address-add.php",username,e,a,i,s)}})}),renderAddress(),$(document).on("click",".item-left i",function(){"active"==$(this).attr("class")?$(this).removeClass("active"):$(this).addClass("active")}),$(document).on("click",".del",function(){var t=1*$(this).attr("data-id");$.ajax({type:"get",url:"http://"+(-1<location.host.indexOf(":5500")?"localhost":location.host)+"/project/address-del.php",data:{username:username,id:t},dataType:"json",success:function(t){layer.msg(t.msg),renderAddress()}})}),$(document).on("click",".edit",function(){$(".setAddress").trigger("click")});